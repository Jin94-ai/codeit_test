# 팀원별 작업 내역 요약

## 프로젝트 개요

| 항목 | 내용 |
|------|------|
| **프로젝트명** | Health Eat - AI 알약 인식 |
| **기간** | 2025.12.04 ~ 12.23 (약 3주) |
| **최종 점수** | **0.96703** (Baseline 대비 +18%) |
| **협업일지** | 40개 |

---

## 프로젝트 진행 스토리

### Phase 1-2: 셋업 & EDA (12/04 ~ 12/09)

| 팀원 | 작업 내용 |
|------|----------|
| **김민우** | EDA 작성, 클래스 불균형/어노테이션 누락 발견 |
| **김나연** | EDA 노트북 (ny_eda.ipynb), 데이터셋 구조 분석 |
| **김보윤** | Git 환경 구축, YOLO 모델 서치 |
| **황유민** | W&B 환경 구축, mAP@[0.75:0.95] 지표 확인 |
| **이진석** | EDA 리뷰/통합, 프로젝트 구조 설계 |

**주요 발견**:
- 학습 데이터: 232개 이미지, **56개 클래스**
- 테스트 데이터: 843개 이미지
- 클래스 불균형 심각 (1:80 비율)

---

### Phase 3: Baseline 모델 (12/09 ~ 12/12)

| 팀원 | 작업 내용 |
|------|----------|
| **김보윤** | Ubuntu 환경 베이스라인 파이프라인 구축 |
| **김민우** | YOLO 데이터셋 변환 모듈 구현 |
| **김나연** | 데이터 전처리 모듈화 |

**결과**: YOLO12m 모델 → Kaggle **0.82점**

---

### Phase 4: AIHub 데이터 증강 시도 (12/11 ~ 12/15)

#### 4-1. 복합경구제 시도 (실패)

| 시도 | 결과 |
|------|------|
| 56개 클래스 필터링 | **0.6** (이미지당 라벨 1개만 → bbox 1개만 검출) |

#### 4-2. 단일경구제 전환

| 작업 | 내용 |
|------|------|
| 문제점 | 이미지당 알약 1개, 어두운 붉은 배경, TB 단위 용량 |
| 해결 | 라벨링만 먼저 다운 → 56개 클래스 필터링 → 데이터셋 다운로드 |
| 다운로드 | 1.5TB, 23시간 소요 |
| 팀 공유 | 클래스당 100개씩 추출 (6GB) |

**결과**: Kaggle + 단일경구제 → **0.822점** (유의미한 개선 X)

---

### Phase 5: 추가 클래스 확보 (12/17 ~ 12/18)

#### 강사님 디렉션 (12/17)
- 테스트 이미지에 **18개 추가 클래스** 존재 확인
- 복합경구제 TL/TS 1, 3, 4에서 추가 클래스 확보 제안

#### 데이터 확장
| 작업 | 내용 |
|------|------|
| TL/TS 다운로드 | 1, 3, 4, 5, 6, 7, 8 |
| 최종 클래스 | 캐글 56개 + 추가 18개 = **74개 클래스** |

#### ROI Crop 시도 (실패)
- bbox를 이미지 전체로 설정하고 학습
- 결과: 알약 bbox 검출 불가

---

### Phase 6: 2-Stage Pipeline 도입 (12/18)

#### 핵심 아이디어
```
기존: 이미지 → YOLO → 74개 클래스 직접 예측 (End-to-end)
변경: 이미지 → Detector → 위치 검출 → Classifier → 분류
```

**분리의 이점**:
1. Detector: 단일 클래스 "Pill" → 위치/박싱만 담당
2. Classifier: 74개 클래스 → 분류만 담당
3. 각각 독립적으로 최적화 가능

| Submission | Score | 내용 |
|------------|-------|------|
| #3 | 0.920 | 2-Stage (YOLO + YOLO-cls) |
| #4 | **0.963** | 2-Stage (YOLO + **ConvNeXt**) |

---

### Phase 7: 데이터 정제 (12/18 ~ 12/19)

#### cleanup_detector_data.py

| 정제 기준 | 값 | 이유 |
|----------|-----|------|
| bbox 개수 | 2~4개 | Kaggle 테스트와 동일 |
| IoU 임계값 | 0.7 | 진짜 중복만 검출 |
| bbox 크기 | 30px 이상 | 너무 작은 bbox 제외 |
| 종횡비 | 3.5 이하 | 비정상 형태 제외 |

#### 핵심 개선
- **문제**: 74개 타겟 클래스 폴더만 스캔 → bbox 누락
- **해결**: 모든 K-code 폴더 스캔 → 전체 bbox 수집

| Submission | Score | 내용 |
|------------|-------|------|
| **#6** | **0.96703** | **Best Score** |

---

### Phase 8: 비즈니스 방향성 논의 & 마무리 (12/18 ~ 12/22)

#### 12/18 팀 회의 - 비즈니스 아젠다 논의

**프로젝트 배경**:
> "유저가 모바일 앱으로 복용 중인 약 사진을 찍으면, 해당 약에 대한 정보를 제공"

| 담당자 | 역할 | 주요 논의 |
|--------|------|----------|
| **김민우** | 서비스 타당성 검토 | B2C 공익성 있으나, B2B 모델 병행 필요 |
| **황유민** | 챗봇 프롬프트 | LLM 연동, Uncertainty Handling 설계 |
| **김나연** | B2B 시장 조사 | 응급구조대/수사기관 높은 가치 |
| **김보윤** | 모델 배포 | Cloud 방식 채택 (앱 ~20MB) |
| **이진석** | 2-Stage 파이프라인 | 팀원 테스트 지원 (submit.py) |

**핵심 결정사항**:
- **Cloud 아키텍처 채택**: 앱 크기 ~20MB, 모델 업데이트 용이
- **Uncertainty Handling**: confidence 기반 3단계 응답
- **B2B SaaS 모델 검토**: 응급구조대, 수사기관 타겟

#### 추가 실험 (실패)
| 실험 | Score | 원인 |
|------|-------|------|
| imgsz 1280 | 0.713 | 학습/추론 불일치 |
| TTA | 0.533 | bbox 정밀도 저하 |

---

## 팀원별 총 기여 요약

### 이진석 (Leader / Integration)
- **핵심 성과**: 2-Stage Pipeline 설계 및 구현
- 프로젝트 구조 설계/유지
- AIHub 데이터 추출 로직 개선 (Best Score 핵심 기여)
- 데이터 정제 스크립트 개발 (cleanup_detector_data.py)
- 코드 리뷰, 기술적 의사결정 지원
- **협업일지**: 12개

### 김민우 (Data Engineer / 서비스 타당성)
- 데이터 EDA 수행 및 발표
- YOLO 데이터셋 변환 모듈 (Ver1/Ver2)
- AIHub 데이터 필터링 및 추출
- 단일경구제 1.5TB 다운로드 및 클래스별 추출
- 데이터 증강 모듈 개발
- **12/18 회의**: B2C/B2B 서비스 타당성 분석, 듀얼 마켓 전략 제안
- **협업일지**: 12개

### 김나연 (Data Engineer / B2B 시장조사)
- 데이터 EDA 노트북 (ny_eda.ipynb)
- 데이터 전처리 모듈화 (ny_augmentation.py, ny_dataset.py)
- AIHub TL 데이터셋 확보
- PyTorch Dataset 클래스 구현
- **12/18 회의**: B2B 시장 조사 (약국/응급구조대/수사기관)
- **협업일지**: 11개

### 김보윤 (Model Architect / 배포)
- YOLO 베이스라인 모델 설계
- Ubuntu 학습 파이프라인 구축 (첫 0.82점)
- 시드 고정 및 체크포인트 관리
- 학습 자동화
- **12/18 회의**: Cloud vs On-Device 아키텍처 검토, ExecuTorch 조사
- **협업일지**: 7개

### 황유민 (Experiment Lead / 챗봇)
- W&B 실험 추적 시스템 구축
- 실험 방향 회의 주관
- 실험 로그 및 스케줄링 관리
- 성능 지표 정의/모니터링
- **12/18 회의**: LLM 챗봇 프롬프트 엔지니어링, Uncertainty Handling 설계
- **협업일지**: 5개

---

## 점수 개선 히스토리

```
0.82 ──────────────────────────────────────────── Baseline
  │
  │  ↓ 복합경구제 56클래스 필터링
  │
0.6 ───────────────────────────────────────────── bbox 1개만 검출
  │
  │  ↑ 단일경구제 + 56클래스 필터링
  │
0.822 ─────────────────────────────────────────── 유의미한 개선 X
  │
  │  ↑ 2-Stage Pipeline (+0.10)
  │
0.920 ─────────────────────────────────────────── YOLO-cls
  │
  │  ↑ ConvNeXt Classifier (+0.043)
  │
0.963 ───────────────────────────────────────────
  │
  │  ↑ 데이터셋 정제
  │
0.967 ─────────────────────────────────────────── Best Score
```

---

## 핵심 성공 요인

1. **2-Stage 분리**: Detection과 Classification 독립 최적화
2. **데이터셋 정제**: 테스트 환경과 유사한 3~4개 bbox 이미지만 사용
3. **ConvNeXt 유지**: YOLO-cls와 분류 정확도 비슷하여 변경 불필요

---

## 핵심 실패 요인 및 교훈

| 시도 | 실패 원인 | 교훈 |
|------|----------|------|
| 복합경구제 bbox 1개 | 이미지당 bbox 1개만 학습 | 데이터 구조 이해 필수 |
| ROI Crop | bbox=이미지 전체 | 크롭 로직 검증 필요 |
| imgsz 1280 | 학습/추론 불일치 | 설정 일관성 유지 |

---

## 결론

3주간 40개의 협업일지를 통해 체계적으로 작업을 기록하고, 팀원 간 역할 분담을 명확히 하여 **Baseline 0.82에서 0.96703까지 +18% 개선** 달성.

핵심은 수많은 **시행착오를 통해 End-to-end의 한계를 인식**하고 **2-Stage Pipeline으로 전환**한 것.
복합경구제 실패, ROI Crop 실패 등을 거치며 **데이터 품질의 중요성**을 체감.
