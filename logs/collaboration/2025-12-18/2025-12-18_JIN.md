# Daily 협업일지

### [1] 오늘 날짜 / 이름 / 팀명

- 날짜: 2025-12-18
- 이름: 이진석 (JIN)
- 팀명: 코드잇 8팀

---

### [2] 오늘 맡은 역할 및 구체적인 작업 내용

✍️ 답변:

Leader & Integration Specialist 역할:

#### 핵심 성과: 2-Stage Pipeline 구현 및 0.96점 달성!

1. **문제 분석**
   - 기존 ROI 크롭 방식의 근본적 문제 발견
   - bbox=[0,0,w,h]로 전체 이미지가 bbox → 배경 구분 불가
   - YOLO가 "이미지 전체 = 알약"으로 학습 → Detection 실패

2. **2-Stage Pipeline 설계 및 구현**
   - Stage 1: Pill Detector (단일 클래스)
   - Stage 2: Pill Classifier (74개 클래스)
   - Detection과 Classification 분리로 각각 최적화

3. **Stage 1: Detector 구현**
   - AIHub 원본 이미지 추출 (`extract_for_detector.py`)
   - Kaggle(232) + AIHub(5000) 데이터 결합
   - YOLO 단일 클래스 학습

4. **Stage 2: Classifier 구현**
   - YOLO Classification 모드 사용
   - 크롭 이미지 74개 클래스 폴더 구조로 변환
   - Early stopping at epoch 21

5. **Inference Pipeline 구현**
   - `pill_pipeline.py` - 2-Stage 통합 파이프라인
   - `submit.py` - Kaggle 제출용 배치 추론

6. **버그 수정 (치명적)**
   - category_id 변환 오류 발견 및 수정
   - YOLO index(1,24,69) → dl_idx(1899,16550,27925)
   - 이 수정으로 0.81 → **0.96** 달성!

---

### [3] 오늘 작업 완료도 체크 (하나만 체크)

- [ ]  🔴 0% (시작 못함)
- [ ]  🟠 25% (시작은 했지만 진척 없음)
- [ ]  🟡 50% (진행 중, 절반 이하)
- [ ]  🔵 75% (거의 완료됨)
- [x]  🟢 100% (완료 및 점검까지 완료)

📌 간단한 근거:

- ✅ 2-Stage Pipeline 설계 및 구현 완료
- ✅ Detector 학습 완료
- ✅ Classifier 학습 완료
- ✅ Inference 파이프라인 구현 완료
- ✅ 버그 수정 및 0.96점 달성!

---

### [4] 오늘 협업 중 제안하거나 피드백한 내용이 있다면?

✍️ 답변:

1. **2-Stage 분리 전략 제안** → 채택 및 성공
   - End-to-end 방식의 한계 극복
   - Detection + Classification 분리로 각각 최적화

2. **Detector threshold 조정**
   - 0.25 → 0.05로 낮춰서 recall 확보
   - 132개 이미지 검출 실패 → 전체 검출 성공

3. **Score 계산 방식**
   - detector_conf × classifier_conf → score 너무 낮음
   - classifier_conf만 사용 → 합리적인 score

---

### [5] 오늘 분석/실험 중 얻은 인사이트나 발견한 문제점은?

✍️ 답변:

#### 핵심 인사이트

| 발견 | 내용 | 영향 |
|------|------|------|
| ROI 크롭 문제 | bbox=[0,0,w,h]로 배경 구분 불가 | Detection 실패 원인 |
| 2-Stage 효과 | Detection/Classification 분리 | 각각 최적화 가능 |
| category_id 버그 | YOLO index vs dl_idx 혼동 | 0.15점 손실 |
| threshold 튜닝 | det_conf 0.25→0.05 | 검출 누락 해결 |

#### 문제 해결 과정

1. **검출 누락 (132개 이미지)**
   - 원인: detector_conf=0.25가 너무 높음
   - 해결: det_conf=0.05로 낮춤

2. **category_id 변환 오류**
   - 원인: YOLO classifier의 names 매핑 미사용
   - 해결: `self.classifier.names[top1_idx]` 직접 사용

3. **Score 이상**
   - 원인: det_conf × cls_conf → 낮은 score
   - 해결: classifier_conf만 사용

---

### [6] 일정 지연이나 협업 중 어려웠던 점이 있다면?

✍️ 답변:

1. **category_id 버그 디버깅**
   - submission 형식 확인 → 값 비교 → 변환 로직 추적
   - DEBUG 출력 추가로 문제 발견
   - YOLO 모델의 class names 구조 이해 필요

2. **Submission 형식 파악**
   - 처음에 잘못된 형식 (image_id, class)
   - 올바른 형식 확인 (annotation_id, image_id, category_id, bbox_x, ...)

---

### [7] 오늘 발표 준비나 커뮤니케이션에서 기여한 부분은?

✍️ 답변:

1. **실험 로그 정리**
   - exp_006.md - 2-Stage Pipeline 전체 과정 기록
   - 시행착오 및 해결 과정 상세 문서화

2. **코드 모듈화**
   - `src/inference/` 패키지 생성
   - 재사용 가능한 Pipeline 클래스

---

### [8] 내일 목표 / 할 일

✍️ 답변:

1. **성능 추가 개선 시도**
   - Detector/Classifier 각각 하이퍼파라미터 튜닝
   - Augmentation 강화

2. **앙상블 시도**
   - 여러 모델 결과 조합
   - NMS/WBF 적용

3. **최종 제출 준비**
   - 최고 점수 모델 확정
   - 발표 자료 준비

---

### [9] 오늘 생성/수정한 파일

| 파일 | 설명 |
|------|------|
| `src/data/aihub/extract_for_detector.py` | AIHub 원본 이미지 추출 (신규) |
| `src/data/yolo_dataset/yolo_export_detector.py` | Detector용 YOLO 데이터셋 생성 (신규) |
| `src/data/yolo_dataset/yolo_export_classifier.py` | Classifier용 YOLO 데이터셋 생성 (신규) |
| `src/data/yolo_dataset/config.py` | AIHub 경로 추가 |
| `src/models/pill_detector.py` | Stage 1 학습 스크립트 (신규) |
| `src/models/pill_classifier.py` | Stage 2 학습 스크립트 (신규) |
| `src/inference/pill_pipeline.py` | 2-Stage 파이프라인 (신규) |
| `src/inference/submit.py` | Kaggle 제출용 배치 추론 (신규) |
| `src/inference/__init__.py` | 패키지 초기화 (신규) |
| `logs/experiments/exp_006.md` | 실험 로그 (신규) |

---

### [10] 최종 결과

| 항목 | Before | After |
|------|--------|-------|
| 점수 | 0.81544 | **0.96** |
| 방식 | End-to-end | 2-Stage Pipeline |
| 개선폭 | - | **+0.145** |

---
